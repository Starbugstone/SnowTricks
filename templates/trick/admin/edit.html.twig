{% extends 'base.html.twig' %}

{% block title %}
    Edit trick {{ trick.name }}
{% endblock %}

{% block body %}
    <div class="trick-container container z-depth-1 mt-5" id="trickEditContainer">

        <!-- Header image with edit buttons -->
        <div class="trick-image-header">

            <img src="https://via.placeholder.com/350x150" alt="" class="responsive-img w100">
            <h1 class="trick-name center-align w100 font-coiny m-0 text-shadow">{{ trick.name }}</h1>
        </div>

        <!-- Images and videos -->
        <div class="row flex-center" id="trick-images">
            {% for i in 0..10 %}
                <div class="col xl2 l3 m6 s12 mt-3">
                    <img src="https://via.placeholder.com/350x150" alt="" class="responsive-img w100 z-depth-2">
                </div>

            {% endfor %}

        </div>

        <h1>edit {{ trick.name }}</h1>

        {% include 'trick/admin/_edit-trick-form.html.twig' with {'form': form, 'trickTagsJson': trick.tagsJson, 'allTagsJson': allTagsJson} %}

        {# Getting the logs #}
        {% if is_granted('ROLE_ADMIN') %}
            <div class="row center">
                <a class="btn waves-effect waves-light mb-3" href="{{ path('trick.history', {'id': trick.id}) }}">view {{ trick.name }} history</a>
            </div>

        {% endif %}

    </div>
{% endblock %}

{% block javascripts %}

    <script>
        //init chips
        document.addEventListener('DOMContentLoaded', function () {
            var elems = document.querySelectorAll('.chips');
            let tagsData = document.querySelector('#trick-tag-data');
            let trickTags = JSON.parse(tagsData.dataset.trickTagsJson);
            let allTags = JSON.parse(tagsData.dataset.allTagsJson);

            let allTagsObj = {};
            allTags.map(
                a =>{
                    allTagsObj["'"+a.name+"'"] = null;
                    return allTagsObj;
                }
            );

            console.log(allTagsObj);

            var instances = M.Chips.init(elems, {
                placeholder: "Add some tags",
                secondaryPlaceholder: "keep adding Tags",
                onChipAdd: chipInput,
                onChipDelete: chipInput,
                data: trickTags.map(function(tt){ return {tag: tt.name}}),
                autocompleteOptions: {
                    data: allTagsObj,
                    limit: Infinity,
                    minLength: 1
                }
            });

            function chipInput(){
                var elem = document.getElementById('chips1');
                var tagInput = document.getElementById('trick_tags');
                var instance = M.Chips.getInstance(elem);
                var tagData = instance.chipsData;

                var tags = [];
                for(var $i=0; $i<tagData.length; $i++){
                    tags.push( tagData[$i].tag.toLowerCase());
                }

                let uniqTags = [...new Set(tags)];
                tagInput.value =JSON.stringify(uniqTags);
            }

        });



    </script>

{% endblock %}



